{"ast":null,"code":"import IterResult from './iterresult';\nimport dateutil from './dateutil';\nimport { isArray } from './helpers';\n\nvar Cache =\n/** @class */\nfunction () {\n  function Cache() {\n    this.all = false;\n    this.before = [];\n    this.after = [];\n    this.between = [];\n  }\n  /**\n   * @param {String} what - all/before/after/between\n   * @param {Array,Date} value - an array of dates, one date, or null\n   * @param {Object?} args - _iter arguments\n   */\n\n\n  Cache.prototype._cacheAdd = function (what, value, args) {\n    if (value) {\n      value = value instanceof Date ? dateutil.clone(value) : dateutil.cloneDates(value);\n    }\n\n    if (what === 'all') {\n      this.all = value;\n    } else {\n      args._value = value;\n      this[what].push(args);\n    }\n  };\n  /**\n   * @return false - not in the cache\n   *         null  - cached, but zero occurrences (before/after)\n   *         Date  - cached (before/after)\n   *         []    - cached, but zero occurrences (all/between)\n   *         [Date1, DateN] - cached (all/between)\n   */\n\n\n  Cache.prototype._cacheGet = function (what, args) {\n    var cached = false;\n    var argsKeys = args ? Object.keys(args) : [];\n\n    var findCacheDiff = function (item) {\n      for (var i = 0; i < argsKeys.length; i++) {\n        var key = argsKeys[i];\n\n        if (String(args[key]) !== String(item[key])) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    var cachedObject = this[what];\n\n    if (what === 'all') {\n      cached = this.all;\n    } else if (isArray(cachedObject)) {\n      // Let's see whether we've already called the\n      // 'what' method with the same 'args'\n      for (var i = 0; i < cachedObject.length; i++) {\n        var item = cachedObject[i];\n        if (argsKeys.length && findCacheDiff(item)) continue;\n        cached = item._value;\n        break;\n      }\n    }\n\n    if (!cached && this.all) {\n      // Not in the cache, but we already know all the occurrences,\n      // so we can find the correct dates from the cached ones.\n      var iterResult = new IterResult(what, args);\n\n      for (var i = 0; i < this.all.length; i++) {\n        if (!iterResult.accept(this.all[i])) break;\n      }\n\n      cached = iterResult.getValue();\n\n      this._cacheAdd(what, cached, args);\n    }\n\n    return isArray(cached) ? dateutil.cloneDates(cached) : cached instanceof Date ? dateutil.clone(cached) : cached;\n  };\n\n  return Cache;\n}();\n\nexport { Cache };","map":{"version":3,"mappings":"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","names":["IterResult","dateutil","isArray","Cache","what","value","args","Date","clone","cloneDates","all","_value","push","cached","argsKeys","Object","keys","findCacheDiff","item","i","length","key","String","cachedObject","iterResult","accept","getValue","_cacheAdd"],"sources":["../../../src/cache.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}