{"ast":null,"code":"import dateutil from '../dateutil';\nimport { notEmpty, repeat, range, isPresent } from '../helpers';\nimport { Frequency } from '../types';\nimport { rebuildYear } from './yearinfo';\nimport { rebuildMonth } from './monthinfo';\nimport { easter } from './easter';\nimport { Time } from '../datetime'; // =============================================================================\n// Iterinfo\n// =============================================================================\n\nvar Iterinfo =\n/** @class */\nfunction () {\n  function Iterinfo(options) {\n    this.options = options;\n  }\n\n  Iterinfo.prototype.rebuild = function (year, month) {\n    var options = this.options;\n\n    if (year !== this.lastyear) {\n      this.yearinfo = rebuildYear(year, options);\n    }\n\n    if (notEmpty(options.bynweekday) && (month !== this.lastmonth || year !== this.lastyear)) {\n      var _a = this.yearinfo,\n          yearlen = _a.yearlen,\n          mrange = _a.mrange,\n          wdaymask = _a.wdaymask;\n      this.monthinfo = rebuildMonth(year, month, yearlen, mrange, wdaymask, options);\n    }\n\n    if (isPresent(options.byeaster)) {\n      this.eastermask = easter(year, options.byeaster);\n    }\n  };\n\n  Object.defineProperty(Iterinfo.prototype, \"lastyear\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastyear : null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"lastmonth\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastmonth : null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearlen\", {\n    get: function () {\n      return this.yearinfo.yearlen;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearordinal\", {\n    get: function () {\n      return this.yearinfo.yearordinal;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mrange\", {\n    get: function () {\n      return this.yearinfo.mrange;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wdaymask\", {\n    get: function () {\n      return this.yearinfo.wdaymask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mmask\", {\n    get: function () {\n      return this.yearinfo.mmask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wnomask\", {\n    get: function () {\n      return this.yearinfo.wnomask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nwdaymask\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.nwdaymask : [];\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nextyearlen\", {\n    get: function () {\n      return this.yearinfo.nextyearlen;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mdaymask\", {\n    get: function () {\n      return this.yearinfo.mdaymask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nmdaymask\", {\n    get: function () {\n      return this.yearinfo.nmdaymask;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Iterinfo.prototype.ydayset = function () {\n    return [range(this.yearlen), 0, this.yearlen];\n  };\n\n  Iterinfo.prototype.mdayset = function (_, month, __) {\n    var start = this.mrange[month - 1];\n    var end = this.mrange[month];\n    var set = repeat(null, this.yearlen);\n\n    for (var i = start; i < end; i++) set[i] = i;\n\n    return [set, start, end];\n  };\n\n  Iterinfo.prototype.wdayset = function (year, month, day) {\n    // We need to handle cross-year weeks here.\n    var set = repeat(null, this.yearlen + 7);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    var start = i;\n\n    for (var j = 0; j < 7; j++) {\n      set[i] = i;\n      ++i;\n      if (this.wdaymask[i] === this.options.wkst) break;\n    }\n\n    return [set, start, i];\n  };\n\n  Iterinfo.prototype.ddayset = function (year, month, day) {\n    var set = repeat(null, this.yearlen);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    set[i] = i;\n    return [set, i, i + 1];\n  };\n\n  Iterinfo.prototype.htimeset = function (hour, _, second, millisecond) {\n    var _this = this;\n\n    var set = [];\n    this.options.byminute.forEach(function (minute) {\n      set = set.concat(_this.mtimeset(hour, minute, second, millisecond));\n    });\n    dateutil.sort(set);\n    return set;\n  };\n\n  Iterinfo.prototype.mtimeset = function (hour, minute, _, millisecond) {\n    var set = this.options.bysecond.map(function (second) {\n      return new Time(hour, minute, second, millisecond);\n    });\n    dateutil.sort(set);\n    return set;\n  };\n\n  Iterinfo.prototype.stimeset = function (hour, minute, second, millisecond) {\n    return [new Time(hour, minute, second, millisecond)];\n  };\n\n  Iterinfo.prototype.getdayset = function (freq) {\n    switch (freq) {\n      case Frequency.YEARLY:\n        return this.ydayset.bind(this);\n\n      case Frequency.MONTHLY:\n        return this.mdayset.bind(this);\n\n      case Frequency.WEEKLY:\n        return this.wdayset.bind(this);\n\n      case Frequency.DAILY:\n        return this.ddayset.bind(this);\n\n      default:\n        return this.ddayset.bind(this);\n    }\n  };\n\n  Iterinfo.prototype.gettimeset = function (freq) {\n    switch (freq) {\n      case Frequency.HOURLY:\n        return this.htimeset.bind(this);\n\n      case Frequency.MINUTELY:\n        return this.mtimeset.bind(this);\n\n      case Frequency.SECONDLY:\n        return this.stimeset.bind(this);\n    }\n  };\n\n  return Iterinfo;\n}();\n\nexport default Iterinfo;","map":{"version":3,"mappings":"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","names":["dateutil","notEmpty","repeat","range","isPresent","Frequency","rebuildYear","rebuildMonth","easter","Time","options","Iterinfo","year","month","lastyear","yearinfo","bynweekday","lastmonth","yearlen","mrange","wdaymask","monthinfo","byeaster","eastermask","Object","yearordinal","mmask","wnomask","nwdaymask","nextyearlen","mdaymask","nmdaymask","_","__","start","end","set","i","day","toOrdinal","Date","UTC","j","wkst","hour","second","millisecond","byminute","forEach","concat","_this","mtimeset","minute","sort","bysecond","map","freq","YEARLY","ydayset","bind","MONTHLY","mdayset","WEEKLY","wdayset","DAILY","ddayset","HOURLY","htimeset","MINUTELY","SECONDLY","stimeset"],"sources":["../../../../src/iterinfo/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}