{"ast":null,"code":"import { __assign } from \"tslib\";\nimport dateutil from '../dateutil';\nimport { empty, repeat, pymod, includes } from '../helpers';\nimport { M365MASK, MDAY365MASK, NMDAY365MASK, WDAYMASK, M365RANGE, M366MASK, MDAY366MASK, NMDAY366MASK, M366RANGE } from '../masks';\nexport function rebuildYear(year, options) {\n  var firstyday = new Date(Date.UTC(year, 0, 1));\n  var yearlen = dateutil.isLeapYear(year) ? 366 : 365;\n  var nextyearlen = dateutil.isLeapYear(year + 1) ? 366 : 365;\n  var yearordinal = dateutil.toOrdinal(firstyday);\n  var yearweekday = dateutil.getWeekday(firstyday);\n\n  var result = __assign(__assign({\n    yearlen: yearlen,\n    nextyearlen: nextyearlen,\n    yearordinal: yearordinal,\n    yearweekday: yearweekday\n  }, baseYearMasks(year)), {\n    wnomask: null\n  });\n\n  if (empty(options.byweekno)) {\n    return result;\n  }\n\n  result.wnomask = repeat(0, yearlen + 7);\n  var firstwkst;\n  var wyearlen;\n  var no1wkst = firstwkst = pymod(7 - yearweekday + options.wkst, 7);\n\n  if (no1wkst >= 4) {\n    no1wkst = 0; // Number of days in the year, plus the days we got\n    // from last year.\n\n    wyearlen = result.yearlen + pymod(yearweekday - options.wkst, 7);\n  } else {\n    // Number of days in the year, minus the days we\n    // left in last year.\n    wyearlen = yearlen - no1wkst;\n  }\n\n  var div = Math.floor(wyearlen / 7);\n  var mod = pymod(wyearlen, 7);\n  var numweeks = Math.floor(div + mod / 4);\n\n  for (var j = 0; j < options.byweekno.length; j++) {\n    var n = options.byweekno[j];\n\n    if (n < 0) {\n      n += numweeks + 1;\n    }\n\n    if (!(n > 0 && n <= numweeks)) {\n      continue;\n    }\n\n    var i = void 0;\n\n    if (n > 1) {\n      i = no1wkst + (n - 1) * 7;\n\n      if (no1wkst !== firstwkst) {\n        i -= 7 - firstwkst;\n      }\n    } else {\n      i = no1wkst;\n    }\n\n    for (var k = 0; k < 7; k++) {\n      result.wnomask[i] = 1;\n      i++;\n      if (result.wdaymask[i] === options.wkst) break;\n    }\n  }\n\n  if (includes(options.byweekno, 1)) {\n    // Check week number 1 of next year as well\n    // orig-TODO : Check -numweeks for next year.\n    var i = no1wkst + numweeks * 7;\n    if (no1wkst !== firstwkst) i -= 7 - firstwkst;\n\n    if (i < yearlen) {\n      // If week starts in next year, we\n      // don't care about it.\n      for (var j = 0; j < 7; j++) {\n        result.wnomask[i] = 1;\n        i += 1;\n        if (result.wdaymask[i] === options.wkst) break;\n      }\n    }\n  }\n\n  if (no1wkst) {\n    // Check last week number of last year as\n    // well. If no1wkst is 0, either the year\n    // started on week start, or week number 1\n    // got days from last year, so there are no\n    // days from last year's last week number in\n    // this year.\n    var lnumweeks = void 0;\n\n    if (!includes(options.byweekno, -1)) {\n      var lyearweekday = dateutil.getWeekday(new Date(Date.UTC(year - 1, 0, 1)));\n      var lno1wkst = pymod(7 - lyearweekday.valueOf() + options.wkst, 7);\n      var lyearlen = dateutil.isLeapYear(year - 1) ? 366 : 365;\n      var weekst = void 0;\n\n      if (lno1wkst >= 4) {\n        lno1wkst = 0;\n        weekst = lyearlen + pymod(lyearweekday - options.wkst, 7);\n      } else {\n        weekst = yearlen - no1wkst;\n      }\n\n      lnumweeks = Math.floor(52 + pymod(weekst, 7) / 4);\n    } else {\n      lnumweeks = -1;\n    }\n\n    if (includes(options.byweekno, lnumweeks)) {\n      for (var i = 0; i < no1wkst; i++) result.wnomask[i] = 1;\n    }\n  }\n\n  return result;\n}\n\nfunction baseYearMasks(year) {\n  var yearlen = dateutil.isLeapYear(year) ? 366 : 365;\n  var firstyday = new Date(Date.UTC(year, 0, 1));\n  var wday = dateutil.getWeekday(firstyday);\n\n  if (yearlen === 365) {\n    return {\n      mmask: M365MASK,\n      mdaymask: MDAY365MASK,\n      nmdaymask: NMDAY365MASK,\n      wdaymask: WDAYMASK.slice(wday),\n      mrange: M365RANGE\n    };\n  }\n\n  return {\n    mmask: M366MASK,\n    mdaymask: MDAY366MASK,\n    nmdaymask: NMDAY366MASK,\n    wdaymask: WDAYMASK.slice(wday),\n    mrange: M366RANGE\n  };\n}","map":{"version":3,"mappings":"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","names":["dateutil","empty","repeat","pymod","includes","M365MASK","MDAY365MASK","NMDAY365MASK","WDAYMASK","M365RANGE","M366MASK","MDAY366MASK","NMDAY366MASK","M366RANGE","rebuildYear","year","options","firstyday","Date","UTC","yearlen","isLeapYear","nextyearlen","yearordinal","toOrdinal","yearweekday","getWeekday","result","baseYearMasks","wnomask","byweekno","firstwkst","wyearlen","no1wkst","wkst","div","Math","floor","mod","numweeks","j","length","n","i","k","wdaymask","lnumweeks","lyearweekday","lno1wkst","valueOf","lyearlen","weekst","wday","mmask","mdaymask","nmdaymask","slice","mrange"],"sources":["../../../../src/iterinfo/yearinfo.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}