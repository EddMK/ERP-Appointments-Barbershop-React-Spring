{"ast":null,"code":"import { DateWithZone } from './datewithzone';\nimport { iter } from './iter/index';\nimport dateutil from './dateutil';\nexport function iterSet(iterResult, _rrule, _exrule, _rdate, _exdate, tzid) {\n  var _exdateHash = {};\n  var _accept = iterResult.accept;\n\n  function evalExdate(after, before) {\n    _exrule.forEach(function (rrule) {\n      rrule.between(after, before, true).forEach(function (date) {\n        _exdateHash[Number(date)] = true;\n      });\n    });\n  }\n\n  _exdate.forEach(function (date) {\n    var zonedDate = new DateWithZone(date, tzid).rezonedDate();\n    _exdateHash[Number(zonedDate)] = true;\n  });\n\n  iterResult.accept = function (date) {\n    var dt = Number(date);\n    if (isNaN(dt)) return _accept.call(this, date);\n\n    if (!_exdateHash[dt]) {\n      evalExdate(new Date(dt - 1), new Date(dt + 1));\n\n      if (!_exdateHash[dt]) {\n        _exdateHash[dt] = true;\n        return _accept.call(this, date);\n      }\n    }\n\n    return true;\n  };\n\n  if (iterResult.method === 'between') {\n    evalExdate(iterResult.args.after, iterResult.args.before);\n\n    iterResult.accept = function (date) {\n      var dt = Number(date);\n\n      if (!_exdateHash[dt]) {\n        _exdateHash[dt] = true;\n        return _accept.call(this, date);\n      }\n\n      return true;\n    };\n  }\n\n  for (var i = 0; i < _rdate.length; i++) {\n    var zonedDate = new DateWithZone(_rdate[i], tzid).rezonedDate();\n    if (!iterResult.accept(new Date(zonedDate.getTime()))) break;\n  }\n\n  _rrule.forEach(function (rrule) {\n    iter(iterResult, rrule.options);\n  });\n\n  var res = iterResult._result;\n  dateutil.sort(res);\n\n  switch (iterResult.method) {\n    case 'all':\n    case 'between':\n      return res;\n\n    case 'before':\n      return res.length && res[res.length - 1] || null;\n\n    case 'after':\n    default:\n      return res.length && res[0] || null;\n  }\n}","map":{"version":3,"mappings":"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","names":["DateWithZone","iter","dateutil","iterSet","iterResult","_rrule","_exrule","_rdate","_exdate","tzid","_exdateHash","_accept","accept","evalExdate","after","before","forEach","rrule","between","date","Number","zonedDate","rezonedDate","dt","isNaN","call","Date","method","args","i","length","getTime","options","res","_result","sort"],"sources":["../../../src/iterset.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}