{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { Frequency } from './types';\nimport { Weekday } from './weekday';\nimport dateutil from './dateutil';\nimport { Days } from './rrule';\nexport function parseString(rfcString) {\n  var options = rfcString.split('\\n').map(parseLine).filter(function (x) {\n    return x !== null;\n  });\n  return __assign(__assign({}, options[0]), options[1]);\n}\nexport function parseDtstart(line) {\n  var options = {};\n  var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n\n  if (!dtstartWithZone) {\n    return options;\n  }\n\n  var _ = dtstartWithZone[0],\n      tzid = dtstartWithZone[1],\n      dtstart = dtstartWithZone[2];\n\n  if (tzid) {\n    options.tzid = tzid;\n  }\n\n  options.dtstart = dateutil.untilStringToDate(dtstart);\n  return options;\n}\n\nfunction parseLine(rfcString) {\n  rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n  if (!rfcString.length) return null;\n  var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n\n  if (!header) {\n    return parseRrule(rfcString);\n  }\n\n  var _ = header[0],\n      key = header[1];\n\n  switch (key.toUpperCase()) {\n    case 'RRULE':\n    case 'EXRULE':\n      return parseRrule(rfcString);\n\n    case 'DTSTART':\n      return parseDtstart(rfcString);\n\n    default:\n      throw new Error(\"Unsupported RFC prop \" + key + \" in \" + rfcString);\n  }\n}\n\nfunction parseRrule(line) {\n  var strippedLine = line.replace(/^RRULE:/i, '');\n  var options = parseDtstart(strippedLine);\n  var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n  attrs.forEach(function (attr) {\n    var _a = attr.split('='),\n        key = _a[0],\n        value = _a[1];\n\n    switch (key.toUpperCase()) {\n      case 'FREQ':\n        options.freq = Frequency[value.toUpperCase()];\n        break;\n\n      case 'WKST':\n        options.wkst = Days[value.toUpperCase()];\n        break;\n\n      case 'COUNT':\n      case 'INTERVAL':\n      case 'BYSETPOS':\n      case 'BYMONTH':\n      case 'BYMONTHDAY':\n      case 'BYYEARDAY':\n      case 'BYWEEKNO':\n      case 'BYHOUR':\n      case 'BYMINUTE':\n      case 'BYSECOND':\n        var num = parseNumber(value);\n        var optionKey = key.toLowerCase(); // @ts-ignore\n\n        options[optionKey] = num;\n        break;\n\n      case 'BYWEEKDAY':\n      case 'BYDAY':\n        options.byweekday = parseWeekday(value);\n        break;\n\n      case 'DTSTART':\n      case 'TZID':\n        // for backwards compatibility\n        var dtstart = parseDtstart(line);\n        options.tzid = dtstart.tzid;\n        options.dtstart = dtstart.dtstart;\n        break;\n\n      case 'UNTIL':\n        options.until = dateutil.untilStringToDate(value);\n        break;\n\n      case 'BYEASTER':\n        options.byeaster = Number(value);\n        break;\n\n      default:\n        throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n    }\n  });\n  return options;\n}\n\nfunction parseNumber(value) {\n  if (value.indexOf(',') !== -1) {\n    var values = value.split(',');\n    return values.map(parseIndividualNumber);\n  }\n\n  return parseIndividualNumber(value);\n}\n\nfunction parseIndividualNumber(value) {\n  if (/^[+-]?\\d+$/.test(value)) {\n    return Number(value);\n  }\n\n  return value;\n}\n\nfunction parseWeekday(value) {\n  var days = value.split(',');\n  return days.map(function (day) {\n    if (day.length === 2) {\n      // MO, TU, ...\n      return Days[day]; // wday instanceof Weekday\n    } // -1MO, +3FR, 1SO, 13TU ...\n\n\n    var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n    var n = Number(parts[1]);\n    var wdaypart = parts[2];\n    var wday = Days[wdaypart].weekday;\n    return new Weekday(wday, n);\n  });\n}","map":{"version":3,"mappings":"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","names":["Frequency","Weekday","dateutil","Days","parseString","rfcString","options","split","map","parseLine","filter","parseDtstart","line","dtstartWithZone","exec","tzid","dtstart","untilStringToDate","replace","length","header","toUpperCase","parseRrule","key","Error","strippedLine","attrs","forEach","value","freq","wkst","num","parseNumber","optionKey","toLowerCase","byweekday","parseWeekday","until","byeaster","Number","indexOf","values","parseIndividualNumber","test","days","day","parts","match","n","wdaypart","wday","weekday"],"sources":["../../../src/parsestring.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}